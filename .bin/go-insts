#!/bin/bash

install() {
	TIMEFORMAT="# %R $@"
	time (
		if ! go install -ldflags="-w -s" "$@"; then
			echo "failed to install $@"
		fi
	) &
}

# modInstall is like install, but for modules using replaces, like gopls.
modInstall() {
	TIMEFORMAT="# %R $@"
	time (
		dir="$(mktemp -d)"
		cd "$dir"
		go mod init test 2>/dev/null

		mainpkg="$1"
		shift
		if ! {
			go get "$@" 2>/dev/null
			go install -ldflags="-w -s" "$mainpkg"
		}; then
			echo "failed to install $tip with $@"
		fi
		cd - >/dev/null
		rm -rf "$dir"
	) &
}

# golang.org
install golang.org/x/review/git-codereview@master
install golang.org/x/tools/cmd/{goimports,stress,stringer,bundle}@master
install golang.org/x/perf/cmd/benchstat@master
install golang.org/x/exp/cmd/gorelease@master
install golang.org/x/vuln/cmd/govulncheck@master

# cuelang.org
install cuelang.org/go/cmd/cue@master
install github.com/cue-sh/tools/cmd/cueckoo@master

# lsp
modInstall golang.org/x/tools/gopls golang.org/x/tools/gopls@master golang.org/x/tools@master

# mvdan.cc
install mvdan.cc/sh/v3/cmd/shfmt@master
install mvdan.cc/xurls/v2/cmd/xurls@master
install mvdan.cc/unparam@master
install mvdan.cc/git-picked@master
install mvdan.cc/gofumpt@master
install mvdan.cc/dockexec@master
install mvdan.cc/garble@master
install mvdan.cc/bitw@master
install mvdan.cc/benchinit@master
# install mvdan.cc/goreduce@master
# install mvdan.cc/fdroidcl@master

# dev tools
install github.com/aclements/go-misc/benchcmd@master
install github.com/rogpeppe/go-internal/cmd/{testscript,txtar-addmod}@master
install golang.org/x/exp/cmd/txtar@master
install github.com/kortschak/gospel@master
install github.com/icholy/gomajor@master

# misc
install github.com/mholt/archiver/v3/cmd/arc@latest
install github.com/itchyny/mmv/cmd/mmv@latest
# install github.com/hanwen/go-mtpfs@latest
install github.com/mdlayher/keylight/cmd/keylight@latest

# linters
install honnef.co/go/tools/cmd/staticcheck@master
install github.com/mdempsky/unconvert@latest
install github.com/mdempsky/maligned@latest
install github.com/mibk/dupl@latest

wait
